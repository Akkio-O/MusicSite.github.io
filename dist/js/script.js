import*as ItemsModule from"./modules/items/items.mjs";import{displayOptions}from"./modules/items/searchItems.mjs";import{addSortEventListeners,addFilterEventListeners}from"./modules/items/filterItems.mjs";window.addEventListener("DOMContentLoaded",(()=>{fetch("http://localhost:8080/categoryGroup").then((e=>e.json())).then((e=>{const t=document.getElementById("categories-list"),o=document.getElementById("categories-context"),n=e.filter(((e,t,o)=>t===o.findIndex((t=>t.IC_GROUP0===e.IC_GROUP0))));n.forEach(((e,o)=>{const n=document.createElement("li");n.classList.add("positionBlock"),n.innerHTML=`\n                    <button data-index="${o+1}">${e.IC_GROUP0}</button>\n                `,t.appendChild(n)})),n.forEach(((t,n)=>{const s=document.createElement("li");s.classList.add("positionBlock");const a=e.filter((e=>e.IC_GROUP0===t.IC_GROUP0)).reduce(((e,t)=>(e.includes(t.IC_GROUP1)||e.push(t.IC_GROUP1),e)),[]);s.innerHTML=`\n        <div class="ContextMenu ContextMenuSupport" id="menu${n+1}">\n            <ul>\n                ${a.map((o=>`\n                    <li>\n                        ${e.some((e=>e.IC_GROUP0===t.IC_GROUP0&&e.IC_GROUP1===o&&e.IC_GROUP2))?`<button class="collapsible">${o}</button>`:`<a href="category/products?category=${encodeURIComponent(t.IC_GROUP0)}&subcategory=${encodeURIComponent(o)}" target="_blank">${o}</a>`}\n                        <div class="content SubCategoryMenu">\n                            <ul>\n                                ${e.filter((e=>e.IC_GROUP0===t.IC_GROUP0&&e.IC_GROUP1===o)).map((e=>`\n                                    <li><a href="category/products?category=${encodeURIComponent(t.IC_GROUP0)}&subcategory=${encodeURIComponent(o)}&subsubcategory=${encodeURIComponent(e.IC_GROUP2)}" target="_blank">${e.IC_GROUP2}</a></li>`)).join("")}\n                            </ul>\n                        </div>\n                    </li>\n                `)).join("")}\n            </ul>\n        </div>\n    `,o.appendChild(s)}));const s=document.querySelectorAll(".positionBlock button"),a=document.querySelectorAll(".ContextMenuSupport");s.forEach((e=>{e.addEventListener("mouseenter",(t=>{const o=e.dataset.index,n=document.querySelector(`#menu${o}`);e.classList.contains("collapsible")||t.target===e&&(a.forEach((e=>{e.classList.remove("active")})),n.classList.add("active"))}))}));function c(){a.forEach((e=>{e.classList.remove("active")}))}document.querySelectorAll(".FrameCategory").forEach((e=>{let t;e.addEventListener("mouseleave",(()=>{t=setTimeout(c,500)})),e.addEventListener("mouseenter",(()=>{clearTimeout(t)}))}));let r,i=document.getElementsByClassName("collapsible");for(r=0;r<i.length;r++)i[r].addEventListener("click",(function(){this.classList.toggle("active");let e=this.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}))})).catch((e=>console.error("Ошибка загрузки категорий:",e)))}));const urlParams=new URLSearchParams(window.location.search),categories=urlParams.getAll("category");0!=categories.length||fetch("http://localhost:8080/getProductsData").then((e=>{if(!e.ok)throw new Error("Ошибка HTTP: "+e.status);return e.json()})).then((e=>{ItemsModule.itemsBlock.querySelectorAll(".col-auto").forEach((e=>e.remove())),ItemsModule.setupPagination(e),ItemsModule.renderPage(1,e),addFilterEventListeners(e),addSortEventListeners(e)}));const instruments=[],search=document.querySelector(".search"),searchOptions=document.querySelector(".options"),formSearch=document.querySelector(".promo_search__form"),searchIcon=formSearch.querySelector("i");let dataLoaded=!1;async function fetchData(e){try{const t=await fetch(e);if(!t.ok)throw new Error("Ошибка HTTP: "+t.status);const o=await t.json();instruments.push(...o),console.log("Данные успешно загружены:",instruments),dataLoaded=!0}catch(e){console.error("Произошла ошибка при загрузке данных:",e)}}function handleSearch(){const e=search.value.trim();if(e){const t=`http://localhost:8080/search?text=${encodeURIComponent(e)}`;window.open(t,"_blank")}}function mediaLg(e){const t=document.querySelector(".promo"),o=document.querySelector(".navMain"),n=document.querySelector(".promo_search_img");e.matches?(o.classList.remove("container"),t.classList.remove("container"),n.classList.remove("col-lg-8")):(t.classList.add("container"),o.classList.remove("container"),n.classList.add("col-lg-8"))}search.addEventListener("input",(function(){const e=this.value;displayOptions(e,instruments)})),search.addEventListener("click",(function(){dataLoaded||fetchData("http://localhost:8080/getProductsData")})),document.addEventListener("click",(function(e){formSearch.contains(e.target)||(search.value="",searchOptions.innerHTML="",searchOptions.style.backgroundColor="transparent")})),search.addEventListener("keydown",(function(e){"Enter"===e.key&&handleSearch()})),searchIcon.addEventListener("click",handleSearch);const l=window.matchMedia("(max-width: 994px)");function mediaXl(e){const t=document.querySelector(".footer_content__container"),o=document.querySelector(".footer_content__row");e.matches?(t.classList.remove("container"),o.classList.add("row")):(t.classList.add("container"),o.classList.remove("row"))}mediaLg(l),l.addListener(mediaLg);const x=window.matchMedia("(max-width: 1200px)");mediaXl(x),x.addListener(mediaXl);