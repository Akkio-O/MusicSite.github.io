import{cart,cartItemsElement,emptyCartMessage,easynetshopGoods,btn_buy__decoration}from"../modules/cart/cart.mjs";import{updateTotalPrice}from"../modules/cart/price.mjs";const createdItems=[];function updateCartCounter(){const t=createdItems.length;cart.textContent=t}function removeFromCart(t){t.remove();const e=createdItems.indexOf(t);-1!==e&&createdItems.splice(e,1);0===document.querySelectorAll(".itemBlock").length&&(easynetshopGoods.style.display="none",emptyCartMessage.style.display="block",btn_buy__decoration.style.display="none"),updateTotalPrice(),updateCartCounter()}function handleBuyButtonClickBuy(t){const e=t.closest(".catalog_content"),n=e.getAttribute("data-XML_ID"),o=e.querySelector(".catalog-item__img").getAttribute("src"),a=e.querySelector(".catalog-item__subtitle").textContent,s=e.querySelector(".catalog-item__old-price").textContent,c=e.querySelector(".catalog-item__price").textContent,l=e.querySelector(".discount").textContent;if(Array.from(cartItemsElement.querySelectorAll(".easynetshop-goodtitle")).some((t=>t.getAttribute("data-XML_ID")===n)))console.log("Что-то не так");else{const t=document.createElement("div");t.className="row itemBlock",t.innerHTML=`\n            <div class="easynetshop-goodtitle col" data-XML_ID="${n}">\n                <img src="${o}" class="item-img col">\n            </div>\n            <div class="col">\n                <span class="easynetshop-goodtitle-name col">${a}</span><br>\n            </div>\n            <div class="easynetshop col">\n                <div class="catalog-item__items counter-wrapper">\n                    <div class="items_control control" data-action="minus">-</div>\n                    <div class="items_control" data-counter>1</div>\n                    <div class="items_control control" data-action="plus">+</div>\n                </div>\n            </div>\n            <div class="easynetshop price_block col">\n            <div data-price="SIGMApc15" class="easynetshop-cur-old-price">\n                <span class="old_price">${s}</span>\n                <span class="discount">${l}%</span>\n            </div>\n                <span class="easynetshop-cur-price">${c}</span>\n                <span class="easynetshop-currency">руб.</span>\n            </div>\n            <div class="col">\n                <button type="button" class="easynetshop-delgood" data-rel="1" title="Удалить из корзины">×</button>\n            </div>\n        `,cartItemsElement.appendChild(t),createdItems.push(t),updateTotalPrice(),updateCartCounter(),easynetshopGoods.style.display="block",emptyCartMessage.style.display="none",btn_buy__decoration.style.display="block";t.querySelector(".easynetshop-delgood").addEventListener("click",(()=>removeFromCart(t))),window.addEventListener("click",(function(t){const e=t.target;e.dataset.action;if(cartItemsElement.contains(e)){document.querySelectorAll(".itemBlock").forEach((t=>{if(0===parseInt(t.querySelector("[data-counter]").textContent)){t.remove();const e=createdItems.indexOf(t);-1!==e&&createdItems.splice(e,1)}}));0===document.querySelectorAll(".itemBlock").length&&(easynetshopGoods.style.display="none",emptyCartMessage.style.display="block",btn_buy__decoration.style.display="none"),updateTotalPrice(),updateCartCounter(),updateQuantity()}}))}}function updateQuantity(){let t=document.querySelector("[data-quanity]");const e=document.querySelectorAll("[data-counter]"),n=Array.from(e).reduce(((t,e)=>t+parseInt(e.textContent,10)),0);t.textContent=n}function handleBuyButtonClickProduct(t){const e=t.closest("main"),n=e.querySelector(".product__container_img").style.backgroundImage.replace('url("',"").replace('")',""),o=e.querySelector(".product__container").getAttribute("data-XML_ID"),a=n,s=e.querySelector(".product__container_title").textContent,c=e.querySelector(".catalog-item__old-price").textContent,l=e.querySelector(".catalog-item__price").textContent,r=e.querySelector(".discount").textContent;if(Array.from(cartItemsElement.querySelectorAll(".easynetshop-goodtitle")).some((t=>t.getAttribute("data-XML_ID")===o)))console.log("Что-то не так");else{const t=document.createElement("div");t.className="row itemBlock",t.innerHTML=`\n            <div class="easynetshop-goodtitle col" data-XML_ID="${o}">\n                <img src="${a}" class="item-img col">\n            </div>\n            <div class="col">\n                <span class="easynetshop-goodtitle-name col">${s}</span><br>\n            </div>\n            <div class="easynetshop col">\n                <div class="catalog-item__items counter-wrapper">\n                    <div class="items_control control" data-action="minus">-</div>\n                    <div class="items_control" data-counter>1</div>\n                    <div class="items_control control" data-action="plus">+</div>\n                </div>\n            </div>\n            <div class="easynetshop price_block col">\n                <div data-price="SIGMApc15" class="easynetshop-cur-old-price">\n                    <span class="old_price">${c}</span>\n                    <span class="discount">${r}%</span>\n                </div>\n                <span class="easynetshop-cur-price">${l}</span>\n                <span class="easynetshop-currency">руб.</span>\n            </div>\n            <div class="col">\n                <button type="button" class="easynetshop-delgood" data-rel="1" title="Удалить из корзины">×</button>\n            </div>\n        `,cartItemsElement.appendChild(t),createdItems.push(t),updateTotalPrice(),updateCartCounter(),easynetshopGoods.style.display="block",emptyCartMessage.style.display="none",btn_buy__decoration.style.display="block";t.querySelector(".easynetshop-delgood").addEventListener("click",(()=>removeFromCart(t))),window.addEventListener("click",(function(t){const e=t.target;if(cartItemsElement.contains(e)){document.querySelectorAll(".itemBlock").forEach((t=>{if(0===parseInt(t.querySelector("[data-counter]").textContent)){t.remove();const e=createdItems.indexOf(t);-1!==e&&createdItems.splice(e,1)}}));0===document.querySelectorAll(".itemBlock").length&&(easynetshopGoods.style.display="none",emptyCartMessage.style.display="block",btn_buy__decoration.style.display="none"),updateTotalPrice(),updateCartCounter(),updateQuantity()}}))}}window.addEventListener("click",(function(t){const e=t.target,n=e.dataset.action,o=e.hasAttribute("data-buy"),a=e.hasAttribute("data-buyItem");if(n){const t=e.closest(".counter-wrapper");if(!t)return;const o=t.querySelector("[data-counter]");let a=parseInt(o.textContent);"plus"===n?a++:"minus"===n&&a>0&&a--,o.textContent=a}o&&(handleBuyButtonClickBuy(e),updateQuantity()),a&&(handleBuyButtonClickProduct(e),updateQuantity())}));